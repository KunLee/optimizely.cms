@*
    ====================================
    Version: 5.0.0.0. Modified: 20210818
    ====================================
*@

@using EPiServer.Forms.Helpers.Internal
@using EPiServer.Forms.Implementation.Elements
@using repos.models.blocks.ElementBlock
@model LookupTextboxElementBlock

@{
    var formContainer = Model.FindOwnerForm();
    var formElement = Model.FormElement;
    var labelText = Model.Label;
    var propertyList = Model.ApiReturnMappings;
    var buttonText = Model.ButtonName;
    var cssClasses = Model.GetValidationCssClasses();
}

@using (Html.BeginElement(Model, new { @class = "FormTextbox" + cssClasses, data_f_type = "textbox" }))
{
    <label for="@formElement.Guid" class="Form__Element__Caption" style="width: 400px; height: 50px">@labelText</label>
    <input name="@formElement.ElementName" id="@formElement.Guid" type="text" class="FormTextbox__Input" size="1500" style="width: 800px"
           aria-describedby="@Util.GetAriaDescribedByElementName(formElement.ElementName)" 
           @(!string.IsNullOrWhiteSpace(Model.PlaceHolder) ? Html.Raw($"placeholder=\"{Model.PlaceHolder}\""): "")
           value="@Model.GetDefaultValue()" @Html.Raw(Model.AttributesString) data-f-datainput
           aria-invalid="@Util.GetAriaInvalidByValidationCssClasses(cssClasses)" />
    <button type="button" class="btn btn-warning btn-sm" onclick="CallWebAPI()"> @buttonText </button>
    @Html.ValidationMessageFor(Model)
    @Model.RenderDataList()

}


<script type="text/javascript">
        
    function CallWebAPI() {
        alert("called me");

        //var name = document.getElementById("txtName").value;
        //var person = '{Name: "' + name + '" }';
        var request;
        if (window.XMLHttpRequest) {
            //New browsers.
            request = new XMLHttpRequest();
        }
        else if (window.ActiveXObject) {
            //Old IE Browsers.
            request = new ActiveXObject("Microsoft.XMLHTTP");
        }
        if (request != null) {
            var url = "https://localhost:7066/api/ExternalService/3";
            request.open("POST", url, false);
            request.setRequestHeader("Content-Type", "application/json");
            request.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
            request.setRequestHeader('Access-Control-Allow-Origin', '*');
            request.onreadystatechange = function () {
                if (request.readyState == 4 && request.status == 200) {
                    var response = JSON.parse(request.responseText);
                    alert(response);
                    //alert("Hello: " + response.Name + ".\nCurrent Date and Time: " + response.DateTime);
                }
            };
            request.send(null);
        }
    }
</script>